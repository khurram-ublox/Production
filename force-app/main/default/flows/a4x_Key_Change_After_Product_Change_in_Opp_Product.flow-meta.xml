<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>55.0</apiVersion>
    <assignments>
        <name>Add_Measure_to_Update_Collection</name>
        <label>Add Measure to Update Collection</label>
        <locationX>270</locationX>
        <locationY>1535</locationY>
        <assignmentItems>
            <assignToReference>MeasuresToBeUpdated</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Measure_Loop</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Measure_Loop</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Current_Records_Quantity_to_Delete_List</name>
        <label>Assign Current Records Quantity to Delete List</label>
        <locationX>182</locationX>
        <locationY>455</locationY>
        <assignmentItems>
            <assignToReference>MeasuresToBeDeleted</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Get_Current_Records_Quantity</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Prior_BudgetDraftCalculated_Records</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Prior_BudgetDraftCalculated_Records_To_Delete</name>
        <label>Assign Prior BudgetDraftCalculated Records To Delete</label>
        <locationX>182</locationX>
        <locationY>695</locationY>
        <assignmentItems>
            <assignToReference>MeasuresToBeDeleted</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Get_Prior_BudgetDraftCalculated_Records</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Prior_Supply_Constraint_Records_GC</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Prior_Supply_Constraint_Records_GC_To_Delete</name>
        <label>Assign Prior Supply Constraint Records GC To Delete</label>
        <locationX>182</locationX>
        <locationY>935</locationY>
        <assignmentItems>
            <assignToReference>MeasuresToBeDeleted</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Get_Prior_Supply_Constraint_Records_GC</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Records_To_Be_Updated_Prior</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Update_Loop_Measure</name>
        <label>Update Loop Measure</label>
        <locationX>270</locationX>
        <locationY>1415</locationY>
        <assignmentItems>
            <assignToReference>Measure_Loop.a4x__Key__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ChangedKey</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Add_Measure_to_Update_Collection</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Update_MeasuresToBeUpdatedSize</name>
        <label>Update MeasuresToBeUpdatedSize</label>
        <locationX>182</locationX>
        <locationY>2207</locationY>
        <assignmentItems>
            <assignToReference>MeasuresToBeUpdatedSize</assignToReference>
            <operator>AssignCount</operator>
            <value>
                <elementReference>MeasuresToBeUpdated</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Has_Measures_To_Be_Updated</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Update_Reporting_Category</name>
        <label>Update Reporting Category</label>
        <locationX>270</locationX>
        <locationY>1295</locationY>
        <assignmentItems>
            <assignToReference>Measure_Loop.Reporting_Category__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Reporting_Category__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_Loop_Measure</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Updated_MeasuresToBeDeletedSize</name>
        <label>Updated MeasuresToBeDeletedSize</label>
        <locationX>182</locationX>
        <locationY>1751</locationY>
        <assignmentItems>
            <assignToReference>MeasuresToBeDeletedSize</assignToReference>
            <operator>AssignCount</operator>
            <value>
                <elementReference>MeasuresToBeDeleted</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Has_MeasuresToBeDeleted</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Has_Measures_To_Be_Updated</name>
        <label>Has Measures To Be Updated</label>
        <locationX>182</locationX>
        <locationY>2327</locationY>
        <defaultConnectorLabel>False</defaultConnectorLabel>
        <rules>
            <name>True1</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>MeasuresToBeUpdatedSize</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Measures_0</targetReference>
            </connector>
            <label>True</label>
        </rules>
    </decisions>
    <decisions>
        <name>Has_MeasuresToBeDeleted</name>
        <label>Has MeasuresToBeDeleted</label>
        <locationX>182</locationX>
        <locationY>1871</locationY>
        <defaultConnector>
            <targetReference>Update_MeasuresToBeUpdatedSize</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>False</defaultConnectorLabel>
        <rules>
            <name>True</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>MeasuresToBeDeletedSize</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Delete_Measures_0</targetReference>
            </connector>
            <label>True</label>
        </rules>
    </decisions>
    <description>Do not change this flow - system use only by the App4Forecast
When the Product in the Opp Product ist changed the Key in the Manual Forecast and Supply Constraint Measures is changed accordingly.</description>
    <environments>Default</environments>
    <formulas>
        <description>Updates the Key with the Ordering Code of the new Product</description>
        <name>ChangedKey</name>
        <dataType>String</dataType>
        <expression>SUBSTITUTE(
SUBSTITUTE(
{!Measure_Loop.a4x__Key__c}
,
&apos;/ProductCategory:&apos; + {!$Record__Prior.Reporting_Category__c}
,
&apos;/ProductCategory:&apos; + {!$Record.Reporting_Category__c}
)
,
&apos;/Product:&apos; + {!$Record__Prior.Ordering_Code__c}
,
&apos;/Product:&apos; + {!$Record.Ordering_Code__c}
)</expression>
    </formulas>
    <formulas>
        <name>Null</name>
        <dataType>Number</dataType>
        <expression>NULL</expression>
        <scale>2</scale>
    </formulas>
    <interviewLabel>a4x Key Change After Product Change in Opp Product {!$Flow.CurrentDateTime}</interviewLabel>
    <label>a4x Key Change After Product Change in Opp Product</label>
    <loops>
        <name>Measure_Loop</name>
        <label>Measure Loop</label>
        <locationX>182</locationX>
        <locationY>1175</locationY>
        <collectionReference>Get_Records_To_Be_Updated_Prior</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Update_Reporting_Category</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Updated_MeasuresToBeDeletedSize</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordDeletes>
        <name>Delete_Measures_0</name>
        <label>Delete Measures</label>
        <locationX>50</locationX>
        <locationY>1991</locationY>
        <connector>
            <targetReference>Update_MeasuresToBeUpdatedSize</targetReference>
        </connector>
        <inputReference>MeasuresToBeDeleted</inputReference>
    </recordDeletes>
    <recordLookups>
        <name>Get_Current_Records_Quantity</name>
        <label>Get Current Records Quantity</label>
        <locationX>182</locationX>
        <locationY>335</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Assign_Current_Records_Quantity_to_Delete_List</targetReference>
        </connector>
        <filterLogic>(1 OR 2 OR 3) AND 4 AND 5 AND 6</filterLogic>
        <filters>
            <field>a4x__Cube__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Manual Forecast</stringValue>
            </value>
        </filters>
        <filters>
            <field>a4x__Cube__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Supply Constraint</stringValue>
            </value>
        </filters>
        <filters>
            <field>a4x__Cube__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>BudgetDraft</stringValue>
            </value>
        </filters>
        <filters>
            <field>a4x__Unit_Type__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Quantity</stringValue>
            </value>
        </filters>
        <filters>
            <field>Project_Owner__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Opportunity__r.Account.SF_Account_Number__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>Product__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Ordering_Code__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>a4x__Measure__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Prior_BudgetDraftCalculated_Records</name>
        <label>Get Prior BudgetDraftCalculated Records</label>
        <locationX>182</locationX>
        <locationY>575</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Assign_Prior_BudgetDraftCalculated_Records_To_Delete</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Project_Owner__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Opportunity__r.Account.SF_Account_Number__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>Product__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record__Prior.Ordering_Code__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>a4x__Cube__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>BudgetDraftCalculated</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>a4x__Measure__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Prior_Supply_Constraint_Records_GC</name>
        <label>Get Prior Supply Constraint Records GC</label>
        <locationX>182</locationX>
        <locationY>815</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Assign_Prior_Supply_Constraint_Records_GC_To_Delete</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>a4x__Unit_Type__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>GC</stringValue>
            </value>
        </filters>
        <filters>
            <field>Project_Owner__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Opportunity__r.Account.SF_Account_Number__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>Product__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record__Prior.Ordering_Code__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>a4x__Cube__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Supply Constraint</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>a4x__Measure__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Records_To_Be_Updated_Prior</name>
        <label>Get Records To Be Updated Prior</label>
        <locationX>182</locationX>
        <locationY>1055</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Measure_Loop</targetReference>
        </connector>
        <filterLogic>(1 OR 2 OR 3) AND 4 AND 5 AND 6</filterLogic>
        <filters>
            <field>a4x__Cube__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Manual Forecast</stringValue>
            </value>
        </filters>
        <filters>
            <field>a4x__Cube__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Supply Constraint</stringValue>
            </value>
        </filters>
        <filters>
            <field>a4x__Cube__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>BudgetDraft</stringValue>
            </value>
        </filters>
        <filters>
            <field>a4x__Unit_Type__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Quantity</stringValue>
            </value>
        </filters>
        <filters>
            <field>Project_Owner__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Opportunity__r.Account.SF_Account_Number__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>Product__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record__Prior.Ordering_Code__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>a4x__Measure__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Update_Measures_0</name>
        <label>Update Measures</label>
        <locationX>50</locationX>
        <locationY>2447</locationY>
        <inputReference>MeasuresToBeUpdated</inputReference>
    </recordUpdates>
    <start>
        <locationX>56</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Get_Current_Records_Quantity</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Ordering_Code__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Flagged_Item__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <object>Opp_Product__c</object>
        <recordTriggerType>Update</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <variables>
        <name>KeyList</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>MeasuresToBeDeleted</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>a4x__Measure__c</objectType>
    </variables>
    <variables>
        <name>MeasuresToBeDeletedSize</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>MeasuresToBeUpdated</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>a4x__Measure__c</objectType>
    </variables>
    <variables>
        <name>MeasuresToBeUpdatedSize</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
</Flow>
